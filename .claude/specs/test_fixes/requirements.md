# 测试失败修复需求文档

## 功能介绍

修复config_manager项目中31个失败的测试用例，主要涉及动态路径生成、跨平台兼容性和多进程支持。

## 用户故事

作为**开发者**，我想要**所有测试用例通过**，以便**确保代码质量和功能正确性**。

作为**用户**，我想要**配置管理器正确生成路径**，以便**在各种环境下正常使用**。

作为**团队成员**，我想要**代码具有良好的跨平台兼容性**，以便**在不同操作系统上都能正常工作**。

## 验收标准（EARS格式）

### 必须满足的要求

1. **当**创建配置管理器时，**系统应**确保paths节点始终使用PathsConfigNode类
2. **当**访问tsb_logs_dir属性时，**系统应**正确返回动态生成的路径
3. **当**访问tensorboard_dir属性时，**系统应**返回与tsb_logs_dir相同的值
4. **当**在Windows环境下生成路径时，**系统应**使用一致的路径分隔符
5. **当**在多进程环境中使用配置时，**系统应**支持正确的序列化
6. **当**生成路径时，**系统应**返回绝对路径而非相对路径

### 边缘情况

1. **如果**paths节点被错误地创建为ConfigNode，**系统应**自动转换为PathsConfigNode
2. **如果**路径包含混合分隔符，**系统应**自动规范化
3. **如果**在测试环境中使用，**系统应**正确处理测试模式路径
4. **如果**配置重新加载，**系统应**保持动态路径功能

## 成功标准

1. 所有31个失败的测试用例全部通过
2. 无新增测试失败
3. 路径生成功能在各平台正常工作
4. 多进程测试正确执行
5. 代码覆盖率保持或提升

## 技术约束

1. 保持向后兼容性
2. 不破坏现有API
3. 保持测试隔离
4. 遵循项目代码规范

## 关键问题分析

### 问题1：AttributeError - ConfigNode缺少tsb_logs_dir属性
- **原因**：paths节点未正确创建为PathsConfigNode
- **影响**：6个测试失败
- **解决方案**：确保始终使用PathsConfigNode类

### 问题2：Windows路径分隔符混合
- **原因**：路径拼接时未统一处理分隔符
- **影响**：跨平台测试失败
- **解决方案**：使用os.path.normpath规范化路径

### 问题3：多进程pickle错误
- **原因**：本地函数无法序列化
- **影响**：多进程测试失败
- **解决方案**：将测试函数定义为模块级函数

### 问题4：相对路径vs绝对路径
- **原因**：路径生成逻辑不一致
- **影响**：路径验证测试失败
- **解决方案**：确保始终返回绝对路径