# Config Manager 最简 Logger 需求规格说明

## 1. 概述

### 1.1 背景
由于custom_logger依赖config_manager，为避免循环依赖，config_manager需要集成一个最简的logger，包含打印和保存文件日志级别，读取config.logger的全局日志配置，按照custom_logger格式输出。

### 1.2 目标
- 避免config_manager和custom_logger之间的循环依赖
- 为config_manager提供统一的日志记录功能
- 保持与custom_logger相同的日志格式
- 支持控制台和文件两种输出方式

## 2. 功能需求

### 2.1 核心功能
1. **日志级别支持**：支持DEBUG、INFO、WARNING、ERROR、CRITICAL五个级别
2. **双重输出**：支持控制台打印和文件保存两种输出方式
3. **配置读取**：从config.logger读取全局日志配置
4. **格式兼容**：日志格式与custom_logger完全兼容
5. **调用者信息**：自动获取调用者文件名和行号信息

### 2.2 日志格式要求
- 格式：`[PID | 模块名 : 行号] 时间戳 - 运行时长 - 级别 - 消息`
- 模块名：8位左对齐，超过8位截断
- 行号：4位右对齐
- 级别：10位居中对齐
- 时间戳：YYYY-MM-DD HH:MM:SS格式
- 运行时长：HH:MM:SS.SS格式

### 2.3 配置要求
- 从config.logger读取以下配置：
  - console_level：控制台日志级别
  - file_level：文件日志级别
  - log_dir：日志文件保存目录
- 支持全局配置，不支持模块特定配置

## 3. 非功能需求

### 3.1 性能要求
- 日志记录不应显著影响config_manager的性能
- 文件写入采用同步方式，避免复杂异步逻辑
- 配置缓存机制，避免重复读取配置

### 3.2 可靠性要求
- 日志记录失败不应影响config_manager的正常功能
- 提供降级机制，配置读取失败时使用默认配置
- 文件写入失败时不影响控制台输出

### 3.3 兼容性要求
- 与现有config_manager代码完全兼容
- 支持Python 3.8及以上版本
- 跨平台兼容（Windows、Linux、macOS）

## 4. 约束条件

### 4.1 技术约束
- 只能使用Python标准库，不能引入第三方依赖
- 不能依赖custom_logger模块
- 不能修改config_manager的公共API接口

### 4.2 架构约束
- 避免循环依赖
- 保持config_manager的模块化设计
- 最小化对现有代码的影响

## 5. 验收标准

### 5.1 功能验收
- [ ] 所有print语句成功替换为logger调用
- [ ] 日志格式与custom_logger完全一致
- [ ] 控制台和文件输出正常工作
- [ ] 配置读取功能正常
- [ ] 调用者信息正确显示

### 5.2 性能验收
- [ ] 日志记录不影响config_manager性能
- [ ] 配置缓存机制有效
- [ ] 文件写入性能可接受

### 5.3 兼容性验收
- [ ] 现有功能不受影响
- [ ] 测试用例全部通过
- [ ] 跨平台兼容性验证通过

## 6. 风险分析

### 6.1 技术风险
- **风险**：配置读取失败导致日志功能不可用
- **缓解**：提供降级机制，使用默认配置

- **风险**：文件写入权限问题
- **缓解**：异常处理，不影响控制台输出

### 6.2 集成风险
- **风险**：替换print语句可能遗漏
- **缓解**：全面代码审查和测试

- **风险**：日志格式不一致
- **缓解**：严格遵循custom_logger格式规范

## 7. 优先级

### 7.1 高优先级
- 核心日志功能实现
- print语句替换
- 格式兼容性

### 7.2 中优先级
- 配置缓存优化
- 性能优化
- 异常处理完善

### 7.3 低优先级
- 日志轮转功能
- 高级配置选项
- 性能监控

## 8. 依赖关系

### 8.1 前置条件
- config_manager现有功能稳定
- custom_logger格式规范明确
- 测试环境准备就绪

### 8.2 后续工作
- 性能测试和优化
- 文档更新
- 用户培训 