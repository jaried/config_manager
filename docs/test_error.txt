FAILED [ 52%]配置已从 /mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/src/config/config.yaml 加载
配置文件监视器已启动

../../../../mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests/01_unit_tests/test_config_manager/test_tc0012_005_project_name_timestamp.py:20 (TestTC0012005ProjectNameTimestamp.test_tc0012_005_001_project_name_from_config)
'test_project' != 'project_name'

预期:'project_name'
实际:'test_project'
<点击以查看差异>

01_unit_tests/test_config_manager/test_tc0012_005_project_name_timestamp.py:28: in test_tc0012_005_001_project_name_from_config
    assert project_name == 'project_name', f"期望project_name为'project_name'，实际: {project_name}"
E   AssertionError: 期望project_name为'project_name'，实际: test_project
E   assert 'test_project' == 'project_name'
E
E     - project_name
E     + test_project
FAILED [ 58%]创建的测试配置文件：/tmp/tmp6zw_41b2/test_config.yaml
原始文件内容：
__data__:
  browser:
    headless: true
    timeout_multiplier: 1000
  url_validation:
    exclude_image_patterns: &id001
      - /avatar/
      - /icon/
      - /logo/
      - favicon
  titles: &id002
    - 测试标题1
    - 测试标题2
    - 测试标题3
__type_hints__: {}

# 使用别名引用
url_validation:
  exclude_image_patterns: *id001
  level2_pattern: ^https://example\.com/.*$
titles: *id002
browser:
  headless: true
  timeout_multiplier: 1000

✓ 基于当前工作目录生成测试路径: /mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests
✓ 基于当前工作目录生成测试路径: /tmp/tests/20250720/101733/b9a7c5a5
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101733/b9a7c5a5, temp_base: /tmp
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101733/b9a7c5a5, temp_base: /tmp
✓ 已从自定义配置复制: /tmp/tmp6zw_41b2/test_config.yaml -> /tmp/tests/20250720/101733/b9a7c5a5/src/config/config.yaml
✓ 使用当前时间作为first_start_time: 2025-07-20 10:17:33.944153
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101733/b9a7c5a5, temp_base: /tmp
配置已从 /tmp/tests/20250720/101733/b9a7c5a5/src/config/config.yaml 加载
保留顶层键 'url_validation': 值与__data__中的不同
保留顶层键 'browser': 值与__data__中的不同
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['titles', 'base_dir', 'config_file_path']
加载的exclude_patterns: ['/avatar/', '/icon/', '/logo/', 'favicon']
加载的titles: ['测试标题1', '测试标题2', '测试标题3']
保留顶层键 'url_validation': 值与__data__中的不同
保留顶层键 'browser': 值与__data__中的不同
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['titles', 'base_dir', 'config_file_path']
配置已自动备份到 /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/backup/20250720/101733/config_20250720_101733.yaml

实际配置文件路径: /tmp/tests/20250720/101733/b9a7c5a5/src/config/config.yaml

保存后的文件内容：
__data__:
  browser:
    headless: true
    timeout_multiplier: 1000
  url_validation:
    exclude_image_patterns:
      - /avatar/
      - /icon/
      - /logo/
      - favicon
  titles:
    - 测试标题1
    - 测试标题2
    - 测试标题3
  base_dir: /tmp/tests/20250720/101733/b9a7c5a5
  config_file_path: /tmp/tests/20250720/101733/b9a7c5a5/src/config/config.yaml
  first_start_time: '2025-07-20T10:17:33.978271'
  __type_hints__:
    first_start_time: datetime
  paths:
    work_dir: /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment
    checkpoint_dir: /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/checkpoint
    best_checkpoint_dir: /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/checkpoint/best
    debug_dir: /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/debug
    tensorboard_dir: /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/tensorboard
    tsb_logs_dir:
      /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/tsb_logs/2025/29/07/20/101733
    log_dir:
      /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/logs/20250720/101733
    backup_dir:
      /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/backup/20250720/101733
  test_field: test_value
__type_hints__: {}

# 使用别名引用
url_validation:
  exclude_image_patterns:
    - /avatar/
    - /icon/
    - /logo/
    - favicon
  level2_pattern: ^https://example\.com/.*$
browser:
  headless: true
  timeout_multiplier: 1000
first_start_time: '2025-07-20T10:17:33.944153'


❌ 发现重复的键：
  键 'first_start_time' 重复:
    第 17 行: first_start_time: '2025-07-20T10:17:33.978271'
    第 19 行: first_start_time: datetime
  键 '__type_hints__' 重复:
    第 18 行: __type_hints__:
    第 33 行: __type_hints__: {}
  键 'url_validation' 重复:
    第 5 行: url_validation:
    第 36 行: url_validation:
  键 'exclude_image_patterns' 重复:
    第 6 行: exclude_image_patterns:
    第 37 行: exclude_image_patterns:
  键 'browser' 重复:
    第 2 行: browser:
    第 43 行: browser:
  键 'headless' 重复:
    第 3 行: headless: true
    第 44 行: headless: true
  键 'timeout_multiplier' 重复:
    第 4 行: timeout_multiplier: 1000
    第 45 行: timeout_multiplier: 1000
  键 'first_start_time' 重复:
    第 17 行: first_start_time: '2025-07-20T10:17:33.978271'
    第 46 行: first_start_time: '2025-07-20T10:17:33.944153'

tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:14 (TestYamlAnchorAliasDuplication.test_anchor_alias_duplication_reproduction)
/home/tony/project/config_manager/tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:95: in test_anchor_alias_duplication_reproduction
    self._check_for_duplicates(saved_content)
/home/tony/project/config_manager/tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:206: in _check_for_duplicates
    assert False, f"发现重复的键: {duplicate_key_names}"
E   AssertionError: 发现重复的键: ['first_start_time', '__type_hints__', 'url_validation', 'exclude_image_patterns', 'browser', 'headless', 'timeout_multiplier', 'first_start_time']
E   assert False
保留顶层键 'url_validation': 值与__data__中的不同
保留顶层键 'browser': 值与__data__中的不同
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['titles', 'base_dir', 'config_file_path']
配置已自动备份到 /tmp/tests/20250720/101733/b9a7c5a5/test_project/test_experiment/backup/20250720/101733/config_20250720_101733.yaml
FAILED [ 59%]✓ 基于当前工作目录生成测试路径: /mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests
✓ 基于当前工作目录生成测试路径: /tmp/tests/20250720/101734/b9a7c5a5
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
✓ 已从自定义配置复制: /tmp/tmp26aemofi/test_config.yaml -> /tmp/tests/20250720/101734/b9a7c5a5/src/config/config.yaml
✓ 使用当前时间作为first_start_time: 2025-07-20 10:17:34.114503
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
配置已从 /tmp/tests/20250720/101734/b9a7c5a5/src/config/config.yaml 加载
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['base_dir', 'config_file_path']
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['base_dir', 'config_file_path']
配置已自动备份到 /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/backup/20250720/101734/config_20250720_101734.yaml
修改后保存的内容：
__data__:
  base_config: &default_config
    timeout: 30
    retries: 3
    debug: false
  base_dir: /tmp/tests/20250720/101734/b9a7c5a5
  config_file_path: /tmp/tests/20250720/101734/b9a7c5a5/src/config/config.yaml
  first_start_time: '2025-07-20T10:17:34.138665'
  __type_hints__:
    first_start_time: datetime
  paths:
    work_dir: /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment
    checkpoint_dir: /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/checkpoint
    best_checkpoint_dir: /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/checkpoint/best
    debug_dir: /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/debug
    tensorboard_dir: /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/tensorboard
    tsb_logs_dir:
      /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/tsb_logs/2025/29/07/20/101734
    log_dir:
      /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/logs/20250720/101734
    backup_dir:
      /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/backup/20250720/101734
  service_a.config.timeout: 60
__type_hints__: {}

# 使用别名引用
service_a:
  config: *default_config
service_b:
  config: *default_config
first_start_time: '2025-07-20T10:17:34.114503'

✓ 基于当前工作目录生成测试路径: /mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests
✓ 基于当前工作目录生成测试路径: /tmp/tests/20250720/101734/b9a7c5a5
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
✓ 已从自定义配置复制: /tmp/tmp26aemofi/test_config.yaml -> /tmp/tests/20250720/101734/b9a7c5a5/src/config/config.yaml
✓ 使用当前时间作为first_start_time: 2025-07-20 10:17:34.196661
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
service_a timeout: None
service_b timeout: None

❌ 发现重复的键：
  键 'first_start_time' 重复:
    第 8 行: first_start_time: '2025-07-20T10:17:34.138665'
    第 10 行: first_start_time: datetime
  键 '__type_hints__' 重复:
    第 9 行: __type_hints__:
    第 24 行: __type_hints__: {}
  键 'config' 重复:
    第 28 行: config: *default_config
    第 30 行: config: *default_config
  键 'first_start_time' 重复:
    第 8 行: first_start_time: '2025-07-20T10:17:34.138665'
    第 31 行: first_start_time: '2025-07-20T10:17:34.114503'

tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:96 (TestYamlAnchorAliasDuplication.test_anchor_alias_modification_behavior)
/home/tony/project/config_manager/tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:156: in test_anchor_alias_modification_behavior
    self._check_for_duplicates(saved_content)
/home/tony/project/config_manager/tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:206: in _check_for_duplicates
    assert False, f"发现重复的键: {duplicate_key_names}"
E   AssertionError: 发现重复的键: ['first_start_time', '__type_hints__', 'config', 'first_start_time']
E   assert False
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['base_dir', 'config_file_path']
配置已自动备份到 /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/backup/20250720/101734/config_20250720_101734.yaml
FAILED [ 59%]✓ 基于当前工作目录生成测试路径: /mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests
✓ 基于当前工作目录生成测试路径: /tmp/tests/20250720/101734/b9a7c5a5
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
✓ 已从自定义配置复制: /tmp/tmpgq7lwdey/complex_config.yaml -> /tmp/tests/20250720/101734/b9a7c5a5/src/config/config.yaml
✓ 使用当前时间作为first_start_time: 2025-07-20 10:17:34.289496
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/101734/b9a7c5a5, temp_base: /tmp
配置已从 /tmp/tests/20250720/101734/b9a7c5a5/src/config/config.yaml 加载
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['base_dir', 'config_file_path']

tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:209 (TestYamlAnchorAliasDuplication.test_complex_anchor_alias_scenario)
None != 'localhost'

预期:'localhost'
实际:None
<点击以查看差异>

/home/tony/project/config_manager/tests/01_unit_tests/test_config_manager/test_tc0014_001_yaml_anchor_alias_duplication.py:260: in test_complex_anchor_alias_scenario
    assert user_db_host == 'localhost'
E   AssertionError: assert None == 'localhost'
保留顶层键 'first_start_time': 值与__data__中的不同
移除顶层重复键: ['base_dir', 'config_file_path']
配置已自动备份到 /tmp/tests/20250720/101734/b9a7c5a5/test_project/test_experiment/backup/20250720/101734/config_20250720_101734.yaml
FAILED [ 99%]✓ 基于当前工作目录生成测试路径: /mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests
✓ 基于当前工作目录生成测试路径: /tmp/tests/20250720/102104/b9a7c5a5
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/102104/b9a7c5a5, temp_base: /tmp
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/102104/b9a7c5a5, temp_base: /tmp
✓ 已从自定义配置复制: /tmp/tmpzjtwh8r6.yaml -> /tmp/tests/20250720/102104/b9a7c5a5/src/config/config.yaml
✓ 使用当前时间作为first_start_time: 2025-07-20 10:21:04.228623
✓ 开始执行路径替换，test_base_dir: /tmp/tests/20250720/102104/b9a7c5a5, temp_base: /tmp
配置已从 /tmp/tests/20250720/102104/b9a7c5a5/src/config/config.yaml 加载
保留顶层键 'database': 值与__data__中的不同
移除顶层重复键: ['app_name', 'version', 'base_dir', 'first_start_time', 'config_file_path']
📊 自动保存调度频率计数: 1
📊 自动保存调度频率计数: 2
保留顶层键 'database': 值与__data__中的不同
移除顶层重复键: ['app_name', 'version', 'base_dir', 'first_start_time', 'config_file_path']
配置已自动备份到 /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/backup/20250720/102104/config_20250720_102104.yaml
添加新键后的配置文件内容:
# 基础配置
database:
  host: localhost  # 主机地址
  port: 5432      # 端口号
__data__:
  app_name: TestApp
  version: 1.0.0
  database:
    host: localhost
    port: 5432
    timeout: 30
  base_dir: /tmp/tests/20250720/102104/b9a7c5a5
  first_start_time: '2025-07-20T10:21:04.228623'
  config_file_path: /tmp/tests/20250720/102104/b9a7c5a5/src/config/config.yaml
  paths:
    work_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment
    checkpoint_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/checkpoint
    best_checkpoint_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/checkpoint/best
    debug_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/debug
    tensorboard_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/tensorboard
    tsb_logs_dir:
      /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/tsb_logs/2025/29/07/20/102104
    log_dir:
      /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/logs/20250720/102104
    backup_dir:
      /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/backup/20250720/102104
  new_feature: enabled
  logging:
    level: INFO
    file: app.log
__type_hints__: {}


../../../../mnt/ntfs/ubuntu_data/NutstoreFiles/invest2025/project/config_manager/tests/test_yaml_comments_preservation.py:127 (test_yaml_comments_preservation_with_new_keys)
'# 数据库配置' != ('# 基础配置\n'
 'database:\n'
 '  host: localhost  # 主机地址\n'
 '  port: 5432      # 端口号\n'
 '__data__:\n'
 '  app_name: TestApp\n'
 '  version: 1.0.0\n'
 '  database:\n'
 '    host: localhost\n'
 '    port: 5432\n'
 '    timeout: 30\n'
 '  base_dir: /tmp/tests/20250720/102104/b9a7c5a5\n'
 "  first_start_time: '2025-07-20T10:21:04.228623'\n"
 '  config_file_path: '
 '/tmp/tests/20250720/102104/b9a7c5a5/src/config/config.yaml\n'
 '  paths:\n'
 '    work_dir: '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment\n'
 '    checkpoint_dir: '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/checkpoint\n'
 '    best_checkpoint_dir: '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/checkpoint/best\n'
 '    debug_dir: '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/debug\n'
 '    tensorboard_dir: '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/tensorboard\n'
 '    tsb_logs_dir: \n'
 '      '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/tsb_logs/2025/29/07/20/102104\n'
 '    log_dir: \n'
 '      '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/logs/20250720/102104\n'
 '    backup_dir: \n'
 '      '
 '/tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/backup/20250720/102104\n'
 '  new_feature: enabled\n'
 '  logging:\n'
 '    level: INFO\n'
 '    file: app.log\n'
 '__type_hints__: {}\n')

<点击以查看差异>

test_yaml_comments_preservation.py:174: in test_yaml_comments_preservation_with_new_keys
    assert "# 数据库配置" in saved_content
E   assert '# \u6570\u636e\u5e93\u914d\u7f6e' in "# \u57fa\u7840\u914d\u7f6e\ndatabase:\n  host: localhost  # \u4e3b\u673a\u5730\u5740\n  port: 5432      # \u7aef\u53e3\u53f7\n__data__:\n  app_name: TestApp\n  version: 1.0.0\n  database:\n    host: localhost\n    port: 5432\n    timeout: 30\n  base_dir: /tmp/tests/20250720/102104/b9a7c5a5\n  first_start_time: '2025-07-20T10:21:04.228623'\n  config_file_path: /tmp/tests/20250720/102104/b9a7c5a5/src/config/config.yaml\n  paths:\n    work_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment\n    checkpoint_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/checkpoint\n    best_checkpoint_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/checkpoint/best\n    debug_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/debug\n    tensorboard_dir: /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/tensorboard\n    tsb_logs_dir: \n      /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/tsb_logs/2025/29/07/20/102104\n    log_dir: \n      /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/logs/20250720/102104\n    backup_dir: \n      /tmp/tests/20250720/102104/b9a7c5a5/test_project/test_experiment/backup/20250720/102104\n  new_feature: enabled\n  logging:\n    level: INFO\n    file: app.log\n__type_hints__: {}\n"
