# 需求文档：TSB日志路径格式更新

## 1. 功能概述

更新配置管理器中的TSB（TensorBoard）日志路径格式，统一路径结构并确保路径一致性。

## 2. 需求背景

当前系统需要更规范的日志目录结构，以便于：
- 按时间周期组织日志文件
- 提高日志查找和管理效率
- 确保TensorBoard相关路径的一致性

## 3. 功能需求

### 3.1 tsb_logs_dir路径格式更新

**需求ID**: REQ-001  
**优先级**: 高  
**描述**: 更新`config.paths.tsb_logs_dir`的路径格式

**具体要求**:
- 基础路径：`config.paths.work_dir/tsb_logs/`
- 完整格式：`{work_dir}/tsb_logs/{yyyy}/{week_number}/{mmdd}/{HHMMSS}`
- 路径组成部分：
  - `{work_dir}`: 工作目录根路径
  - `tsb_logs`: 固定子目录名
  - `{yyyy}`: 4位年份（如2025）
  - `{week_number}`: 2位周数，不带前缀（如01、02、52）
  - `{mmdd}`: 月份和日期（如0107）
  - `{HHMMSS}`: 时分秒（如181520）

**示例**:
```
/home/user/project/work/tsb_logs/2025/02/0107/181520/
```

### 3.2 tensorboard_dir路径一致性

**需求ID**: REQ-002  
**优先级**: 高  
**描述**: 确保`config.paths.tensorboard_dir`始终等于`config.paths.tsb_logs_dir`

**具体要求**:
- `tensorboard_dir`必须自动跟随`tsb_logs_dir`的值
- 不允许独立设置`tensorboard_dir`的值
- 任何对`tsb_logs_dir`的修改都应自动反映到`tensorboard_dir`

## 4. 非功能需求

### 4.1 兼容性要求

- **向后兼容**: 需要提供迁移方案，处理旧格式路径
- **跨平台**: 路径格式必须在Windows、Linux、macOS上都能正常工作
- **测试隔离**: 测试模式下的路径格式保持一致

### 4.2 性能要求

- 路径生成不应影响系统性能
- 路径计算应该被缓存以避免重复计算

### 4.3 可靠性要求

- 路径生成必须保证唯一性
- 周数计算必须遵循ISO 8601标准
- 路径创建失败时应有明确的错误提示

## 5. 约束条件

### 5.1 技术约束

- 必须使用Python标准库进行日期时间计算
- 路径处理必须使用`pathlib`或`os.path`
- 不引入新的第三方依赖

### 5.2 格式约束

- 周数必须是两位数字（01-53）
- 不使用任何字母前缀（如W、w等）
- 路径分隔符必须适应操作系统

## 6. 验收标准

### 6.1 功能验收

1. `tsb_logs_dir`生成的路径符合新格式要求
2. `tensorboard_dir`的值始终等于`tsb_logs_dir`
3. 路径在不同操作系统上都能正常工作
4. 周数计算正确（第1周到第52/53周）

### 6.2 测试验收

1. 单元测试覆盖所有路径生成场景
2. 集成测试验证路径一致性
3. 跨平台测试通过
4. 边界情况测试（如年初、年末的周数计算）

## 7. 相关影响

### 7.1 现有功能影响

- 所有使用`tsb_logs_dir`的代码需要适配新路径
- 所有使用`tensorboard_dir`的代码行为不变
- 备份和日志管理脚本可能需要更新

### 7.2 数据迁移

- 需要提供旧路径到新路径的迁移工具
- 保留旧路径的读取能力（可选）

## 8. 风险评估

### 8.1 技术风险

- **风险**: 周数计算在年初年末可能出现偏差
- **缓解**: 严格遵循ISO 8601标准，充分测试边界情况

### 8.2 兼容性风险

- **风险**: 现有系统依赖旧路径格式
- **缓解**: 提供配置选项支持旧格式（过渡期）

## 9. 未来扩展

- 支持自定义路径格式模板
- 支持路径压缩和归档策略
- 支持路径别名和符号链接