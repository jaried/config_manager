# 任务列表：TSB日志路径格式更新

## 任务概览

本文档定义了实现TSB日志路径格式更新功能的具体任务列表，包括任务优先级、依赖关系和验收标准。

## 任务分类

### 1. 核心功能实现 (P0 - 最高优先级)

#### TASK-001: 实现路径生成函数
**优先级**: P0  
**预计工时**: 2小时  
**依赖**: 无  
**描述**: 实现`generate_tsb_logs_path`函数，生成符合新格式的路径

**具体步骤**:
1. 在`src/config_manager/core/path_resolver.py`中添加路径生成函数
2. 实现ISO周数计算逻辑
3. 确保周数格式化为两位数字
4. 添加路径组合逻辑

**验收标准**:
- [ ] 函数能正确生成格式化路径
- [ ] 周数计算符合ISO 8601标准
- [ ] 路径格式为`{work_dir}/tsb_logs/{yyyy}/{week}/{mmdd}/{HHMMSS}`

#### TASK-002: 修改PathConfiguration类
**优先级**: P0  
**预计工时**: 3小时  
**依赖**: TASK-001  
**描述**: 更新`PathConfiguration`类以支持动态路径生成

**具体步骤**:
1. 修改`src/config_manager/core/path_configuration.py`
2. 将`tsb_logs_dir`改为动态属性
3. 实现路径缓存机制
4. 添加时间戳管理

**验收标准**:
- [ ] `tsb_logs_dir`返回动态生成的路径
- [ ] 缓存机制正常工作
- [ ] 路径随时间更新

#### TASK-003: 实现tensorboard_dir一致性
**优先级**: P0  
**预计工时**: 2小时  
**依赖**: TASK-002  
**描述**: 确保`tensorboard_dir`始终等于`tsb_logs_dir`

**具体步骤**:
1. 创建`TensorBoardDirDescriptor`描述符类
2. 在`PathConfiguration`中应用描述符
3. 禁止直接设置`tensorboard_dir`
4. 添加错误处理

**验收标准**:
- [ ] `tensorboard_dir`总是返回`tsb_logs_dir`的值
- [ ] 尝试设置`tensorboard_dir`抛出`AttributeError`
- [ ] 描述符正确实现`__get__`和`__set__`方法

### 2. 跨平台支持 (P1 - 高优先级)

#### TASK-004: 更新跨平台路径处理
**优先级**: P1  
**预计工时**: 2小时  
**依赖**: TASK-001  
**描述**: 确保新路径格式在所有平台正常工作

**具体步骤**:
1. 更新`src/config_manager/core/cross_platform_paths.py`
2. 使用`pathlib`处理路径分隔符
3. 测试Windows、Linux、macOS兼容性
4. 处理路径规范化

**验收标准**:
- [ ] 路径在Windows上使用反斜杠
- [ ] 路径在Unix系统使用正斜杠
- [ ] 路径转换不影响功能

### 3. 测试实现 (P1 - 高优先级)

#### TASK-005: 编写路径生成单元测试
**优先级**: P1  
**预计工时**: 2小时  
**依赖**: TASK-001  
**描述**: 为路径生成函数编写全面的单元测试

**测试文件**: `tests/01_unit_tests/test_config_manager/test_tsb_logs_path_generation.py`

**测试用例**:
1. 基本路径生成测试
2. 周数边界测试（年初、年末）
3. 闰年测试
4. 时区处理测试

**验收标准**:
- [ ] 所有测试用例通过
- [ ] 覆盖率达到95%以上
- [ ] 边界情况正确处理

#### TASK-006: 编写路径一致性测试
**优先级**: P1  
**预计工时**: 2小时  
**依赖**: TASK-003  
**描述**: 测试`tensorboard_dir`和`tsb_logs_dir`的一致性

**测试文件**: `tests/01_unit_tests/test_config_manager/test_path_consistency.py`

**测试用例**:
1. 路径一致性测试
2. 只读属性测试
3. 动态更新测试
4. 多线程访问测试

**验收标准**:
- [ ] 路径始终保持一致
- [ ] 设置操作正确抛出异常
- [ ] 线程安全性得到验证

### 4. 集成和兼容性 (P2 - 中优先级)

#### TASK-007: 更新现有代码引用
**优先级**: P2  
**预计工时**: 3小时  
**依赖**: TASK-002, TASK-003  
**描述**: 更新所有使用旧路径格式的代码

**具体步骤**:
1. 搜索所有引用`tsb_logs_dir`的代码
2. 确保代码兼容新的动态路径
3. 更新相关文档和注释
4. 验证功能正常

**验收标准**:
- [ ] 所有引用已更新
- [ ] 现有功能不受影响
- [ ] 测试全部通过

#### TASK-008: 实现向后兼容支持
**优先级**: P2  
**预计工时**: 4小时  
**依赖**: TASK-007  
**描述**: 添加对旧路径格式的兼容支持

**具体步骤**:
1. 实现旧路径检测函数
2. 添加路径迁移工具
3. 提供配置选项支持旧格式
4. 编写迁移文档

**验收标准**:
- [ ] 能正确识别旧格式路径
- [ ] 迁移工具正常工作
- [ ] 兼容模式可配置

### 5. 文档和示例 (P3 - 低优先级)

#### TASK-009: 更新API文档
**优先级**: P3  
**预计工时**: 1小时  
**依赖**: 所有功能任务  
**描述**: 更新相关API文档和使用说明

**更新内容**:
1. README.md中的路径说明
2. API参考文档
3. 配置示例
4. 迁移指南

**验收标准**:
- [ ] 文档准确反映新功能
- [ ] 包含使用示例
- [ ] 迁移步骤清晰

#### TASK-010: 创建示例代码
**优先级**: P3  
**预计工时**: 1小时  
**依赖**: 所有功能任务  
**描述**: 创建展示新功能的示例代码

**示例内容**:
1. 基本使用示例
2. 路径访问示例
3. 错误处理示例
4. 迁移示例

**验收标准**:
- [ ] 示例代码可运行
- [ ] 覆盖主要使用场景
- [ ] 包含注释说明

## 任务时间线

### 第一阶段（核心功能）
- TASK-001: 路径生成函数 (Day 1)
- TASK-002: PathConfiguration修改 (Day 1-2)
- TASK-003: tensorboard_dir一致性 (Day 2)

### 第二阶段（测试和平台支持）
- TASK-004: 跨平台支持 (Day 3)
- TASK-005: 路径生成测试 (Day 3)
- TASK-006: 一致性测试 (Day 3-4)

### 第三阶段（集成和文档）
- TASK-007: 更新代码引用 (Day 4)
- TASK-008: 向后兼容 (Day 4-5)
- TASK-009: 更新文档 (Day 5)
- TASK-010: 创建示例 (Day 5)

## 风险和缓解措施

### 风险1: 周数计算复杂性
**缓解**: 使用Python标准库的`isocalendar()`方法，充分测试边界情况

### 风险2: 现有系统依赖
**缓解**: 提供兼容模式，逐步迁移

### 风险3: 路径缓存一致性
**缓解**: 实现合理的缓存过期策略

## 完成标准

1. 所有P0任务完成并测试通过
2. 代码覆盖率达到90%以上
3. 文档更新完整
4. 无回归问题
5. 跨平台测试通过

## 后续优化

- 支持自定义路径模板
- 添加路径压缩功能
- 实现智能路径清理